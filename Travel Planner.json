{
  "name": "Travel Planner 3",
  "nodes": [
    {
      "parameters": {
        "path": "travel-planner",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        384,
        64
      ],
      "id": "eff52211-57a8-403d-93e0-ed6ceff4106b",
      "name": "1. é¡¯ç¤ºç¶²é  (GET)",
      "webhookId": "efa054a6-57de-460f-afed-e36cbb1e6b0e"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.html }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        816,
        64
      ],
      "id": "ee5148a4-6727-439c-a9ef-5cc0d93c2663",
      "name": "3. æ¸²æŸ“ç¶²é "
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "travel-submit",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        384,
        320
      ],
      "id": "59dc0cc2-2e85-4d1f-9302-11aaef1449b3",
      "name": "4. æ¥æ”¶è³‡æ–™ (POST)",
      "webhookId": "f7221c2f-dcb9-4452-83a7-5b50d947f8cc"
    },
    {
      "parameters": {
        "jsCode": "// ä½¿ç”¨ Backticks (`) ä¾†åŒ…ä½æ•´å€‹ HTML å­—ä¸²ï¼Œé€™æ¨£å°±ä¸æœƒå‡ºéŒ¯äº†\nconst htmlContent = `\n<!DOCTYPE html>\n<html lang=\"zh-TW\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<title>AI æ—…éŠè¦åŠƒ</title>\n<style>\n  body { font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif; background: #f4f4f9; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }\n  .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }\n  h2 { text-align: center; color: #333; margin-bottom: 1.5rem; }\n  label { display: block; margin-bottom: 0.5rem; color: #666; font-weight: 500; }\n  input, textarea { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 16px; }\n  input:focus, textarea:focus { outline: none; border-color: #007bff; }\n  button { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; transition: background 0.2s; }\n  button:hover { background: #0056b3; }\n</style>\n</head>\n<body>\n<div class=\"card\">\n  <h2>âœˆï¸ æ—…éŠè¡Œç¨‹è¦åŠƒ</h2>\n  <form action=\"travel-submit\" method=\"POST\">\n    <label>ğŸ“ æƒ³å»å“ªè£¡ï¼Ÿ</label>\n    <input type=\"text\" name=\"location\" required placeholder=\"ä¾‹å¦‚ï¼šäº¬éƒ½ã€å€«æ•¦\">\n    \n    <label>ğŸ“… é è¨ˆå»å¹¾å¤©ï¼Ÿ</label>\n    <input type=\"number\" name=\"days\" required placeholder=\"ä¾‹å¦‚ï¼š5\">\n    \n    <label>ğŸ¨ æ—…éŠé¢¨æ ¼ / èˆˆè¶£</label>\n    <textarea name=\"style\" rows=\"4\" required placeholder=\"ä¾‹å¦‚ï¼šè¦ªå­è‚²æ¨‚ã€é ‚ç´šå¥¢è¯ã€æˆ¶å¤–é‹å‹•...\"></textarea>\n    \n    <button type=\"submit\">é–‹å§‹è¦åŠƒè¡Œç¨‹</button>\n  </form>\n</div>\n</body>\n</html>\n`;\n\n// å›å‚³ JSON ç‰©ä»¶çµ¦ä¸‹ä¸€å€‹ç¯€é»\nreturn {\n  json: {\n    html: htmlContent\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        592,
        64
      ],
      "id": "814393d9-a526-49b6-995f-b29182ed5ae0",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        480,
        800
      ],
      "id": "3b3ed846-b885-4984-93ba-3e5aa034aee0",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "2dZtIF7hDKDK2TeZ",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.body.sessionId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        624,
        800
      ],
      "id": "df13e4c7-493a-4abe-b5e2-ac0248311039",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body.chatInput }}",
        "options": {
          "systemMessage": "=ä½ æ˜¯ä¸€ä½å…¨èƒ½ä¸”è¬›æ±‚è­‰æ“šçš„ã€Œè³‡æ·±æ—…éŠè¦åŠƒç¸½ç›£ã€ã€‚ä½ çš„ç›®æ¨™æ˜¯ç‚ºä½¿ç”¨è€…è¦åŠƒä¸€ä»½**ã€Œå‹•ç·šé †æš¢ã€è³‡è¨Šå®Œæ•´ä¸”æœ‰æ·±åº¦ã€**çš„æ—…éŠè¡Œç¨‹è¡¨ã€‚\n\n**çµ•å°ç¦ä»¤ (Critical Constraints)ï¼š**\n1. **åš´ç¦è¼¸å‡ºã€Œå¾…ç¢ºèªã€**ï¼šæ‰€æœ‰æ¬„ä½å¿…é ˆå¡«æ»¿ã€‚\n2. **åš´ç¦äº¤å‡ºåŠæˆå“**ï¼šè‹¥è³‡æ–™ä¸è¶³ï¼Œå¿…é ˆè‡ªå‹•é‡è©¦ç›´åˆ°æˆåŠŸã€‚\n3. **å¯§ç¼ºå‹¿æ¿«**ï¼šè‹¥ Google Places API æŸ¥ç„¡è³‡æ–™æˆ–é¡¯ç¤ºåœæ¥­ï¼Œ**ç›´æ¥å‰”é™¤**ï¼Œä¸å¯å‹‰å¼·æ¨è–¦ã€‚\n\n**åŸ·è¡Œç­–ç•¥ (Smart Execution Strategy)ï¼š**\n\n**Rule 1: åˆ†æ®µè¼¸å‡º(Chunking)**\n- è‹¥ç‚ºé è¨ˆ2å¤©(å«)ä»¥ä¸Šçš„è¡Œç¨‹ï¼Œ**è«‹å…ˆè¦åŠƒ Day 1 çš„å®Œæ•´è¡Œç¨‹ä¸¦è¼¸å‡º**ã€‚\n- æ–‡æœ«è©¢å•ï¼šã€ŒDay 1 è¡Œç¨‹é‚„æ»¿æ„å—ï¼Ÿæ˜¯å¦ç¹¼çºŒè¦åŠƒ Day 2ï¼Ÿã€\n- å¾…ä½¿ç”¨è€…ç¢ºèªå¾Œï¼Œå†ç¹¼çºŒè¦åŠƒä¸‹ä¸€å¤©çš„å®Œæ•´è¡Œç¨‹ã€‚\n- å®Œæ•´è¡Œç¨‹æ‡‰è‡³å°‘åŒ…æ‹¬æ—©ä¸Šã€åˆé¤ã€ä¸‹åˆã€ä½å®¿(è‹¥éœ€è¦éå¤œ)\n\n**Rule 2: æ™ºæ…§å¿«å– (Smart Reuse)**\n- åœ¨è¦åŠƒè¡Œç¨‹å‰ï¼Œ**å…ˆæª¢æŸ¥å°è©±ç´€éŒ„(Memory)**ã€‚\n- è‹¥æŸå€‹åœ°é»åœ¨ä¹‹å‰çš„å°è©±ä¸­**å·²ç¶“æŸ¥è­‰é**ï¼ˆå³å·²æœ‰åœ°å€èˆ‡ç‡Ÿæ¥­æ™‚é–“ï¼‰ï¼Œ**è«‹ç›´æ¥æ²¿ç”¨èˆŠè³‡æ–™**ï¼Œåš´ç¦å†æ¬¡å‘¼å« APIï¼Œä»¥ç¯€çœæ™‚é–“ã€‚\n- **åªé‡å°**ã€Œæ–°å¢çš„åœ°é»ã€æˆ–ã€Œä½¿ç”¨è€…è¦æ±‚æ›´æ›çš„åœ°é»ã€åŸ·è¡Œæ–°çš„æœå°‹èˆ‡é©—è­‰ã€‚\n\n**Rule 3: é—œéµå­—æ·¨åŒ– (Query Cleaning)**\n- å‘¼å« `Google Places Details` å‰ï¼Œå¿…é ˆ**ç§»é™¤**åº—åä¸­çš„å½¢å®¹è©ï¼ˆå¦‚ï¼šå¹³åƒ¹ã€å¥½åƒã€å¿…åƒã€è€å­—è™Ÿï¼‰ï¼Œåªä¿ç•™**æ ¸å¿ƒåº—å + åŸå¸‚**ã€‚\n- éŒ¯èª¤ç¯„ä¾‹ï¼š`\"Cheap Tasty Joe's Burger New York\"`\n- æ­£ç¢ºç¯„ä¾‹ï¼š`\"Joe's Burger New York\"`\n\n**åŸ·è¡Œ SOP (Step-by-Step)ï¼š**\n\n**Phase 1: å»£æ³›æœå°‹ (Google Search)**\n1. é‡å°ç›®å‰çš„ç©ºç™½è¡Œç¨‹æ ¼ï¼Œæœå°‹ `[åœ°é»] [é¢¨æ ¼] [é¡åˆ¥] æ¨è–¦ {{ $now.format('yyyy') }}`ã€‚\n2. å¾æ‘˜è¦ä¸­æŒ‘é¸å€™é¸åå–®ã€‚\n3. **è»Ÿè³‡è¨ŠæŒ–æ˜**ï¼šè‹¥æ‘˜è¦è³‡è¨Šå¤ªå°‘ï¼Œå…è¨±é‡å°è©²åœ°é»ä½¿ç”¨ `read_page` (æ¯åœ°é»é™ 1 ç¯‡) æŒ–æ˜ç‰¹è‰²ã€‚\n\n**Phase 2: ç¡¬è³‡è¨Šé©—è­‰ (Google Places API)**\n1. é‡å°å€™é¸åå–®ï¼ˆä¸”å°šæœªåœ¨è¨˜æ†¶ä¸­æŸ¥è­‰éçš„ï¼‰ï¼Œå‘¼å« `Google Places Details`ã€‚\n2. **æŸ¥è­‰é‡é» (é©—æ”¶æ¨™æº–)**ï¼š\n   - **åœ°å€ & ç‡Ÿæ¥­æ™‚é–“**ï¼šå¿…é ˆæˆåŠŸç²å– API å›å‚³çš„æ¨™æº–åœ°å€èˆ‡ç‡Ÿæ¥­æ™‚é–“è¡¨ã€‚\n   - **ç‡Ÿæ¥­ç‹€æ…‹**ï¼šè‹¥ API é¡¯ç¤º `open_now: false` (æ°¸ä¹…åœæ¥­) æˆ– `æŸ¥ç„¡æ­¤åœ°`ï¼Œ**ç›´æ¥å‰”é™¤**ä¸¦æ‰¾å‚™æ¡ˆã€‚\n3. **ç²å–åº§æ¨™**ï¼šè«‹ç‰¹åˆ¥ç•™æ„ API å›å‚³çš„ `lat` (ç·¯åº¦) èˆ‡ `lng` (ç¶“åº¦) è³‡è¨Šï¼Œé€™å°‡ç”¨æ–¼è¨ˆç®—äº¤é€šæ™‚é–“ã€‚\n\n**Phase 3: å‹•ç·šæ’åºèˆ‡äº¤é€šè¨ˆç®— (Logistics & Distance)**\nåœ¨æ­¤éšæ®µï¼Œå¿…é ˆåƒå°éŠä¸€æ¨£æ€è€ƒï¼Œä¸å¯éš¨æ„æ’åˆ—ï¼š\n1. **å€åŸŸé›†ä¸­åŸå‰‡ (Clustering)**ï¼š\n   - è«‹å°‡åŒä¸€å¤©è¡Œç¨‹é›†ä¸­åœ¨ **ã€Œç›¸åŒæˆ–é„°è¿‘çš„è¡Œæ”¿å€/è¡—å€ã€**ã€‚\n   - éŒ¯èª¤ï¼šå€åŸŸ A -> é æ–¹å€åŸŸ B -> å€åŸŸ A (æŠ˜è¿”è·‘)ã€‚\n   - æ­£ç¢ºï¼šå€åŸŸ A æ™¯é»é›†ä¸­å®‰æ’ -> ç§»å‹• -> å€åŸŸ B æ™¯é»é›†ä¸­å®‰æ’ã€‚\n2. **è·¨æ—¥éŠœæ¥æª¢æŸ¥ (Overnight Transition)**ï¼š\n   - åœ¨è¦åŠƒ Day N çš„ç¬¬ä¸€å€‹æ™¯é»æ™‚ï¼Œ**å‹™å¿…è¨ˆç®—**å®ƒèˆ‡ Day N-1 ä½å®¿åœ°é»çš„è·é›¢ã€‚\n   - ç¢ºä¿æ¯å¤©æ—©ä¸Šçš„å‡ºç™¼è»Šç¨‹æ§åˆ¶åœ¨åˆç†ç¯„åœ (å»ºè­° 1 å°æ™‚å…§ï¼Œè¦–åœ°å€å»£åº¦è€Œå®š)ã€‚\n3. **ç²¾ç¢ºäº¤é€šè¨ˆç®— (å¿…åš)**ï¼š\n   - é‡å°è¡Œç¨‹ä¸­ã€Œç›¸é„°çš„å…©å€‹åœ°é»ã€(å« Day 1 ä½å®¿ -> Day 2 ç¬¬ä¸€ç«™)ï¼Œ**å‹™å¿…å‘¼å« `Distance Calculator` å·¥å…·**ã€‚\n   - åƒæ•¸è¨­å®šï¼šå°‡å‰ä¸€å€‹åœ°é»çš„ `lat/lng` ä½œç‚ºèµ·é»ï¼Œä¸‹ä¸€å€‹åœ°é»çš„ `lat/lng` ä½œç‚ºçµ‚é»ã€‚\n   - **å¡«å¯«**ï¼šå°‡å·¥å…·å›å‚³çš„ `est_drive_time` (é ä¼°è»Šç¨‹) å¡«å…¥è¡Œç¨‹è¡¨çš„ã€Œç§»å‹•ã€æ¬„ä½ã€‚\n\n**Phase 4: è¼¸å‡º Markdown è¡¨æ ¼**\n\n**è¼¸å‡ºæ ¼å¼ç¯„ä¾‹ï¼š**\n\n## ğŸ—ºï¸ [åœ°é»] Day [X] è¡Œç¨‹ - [é¢¨æ ¼]\n\n* **09:00 - 11:00**ï¼šğŸ“ **[æ™¯é»åç¨±]** (å»ºè­°åœç•™ï¼šxxå°æ™‚)\n    * ç‰¹è‰²ï¼šğŸ’¡ [è»Ÿè³‡è¨Šä»‹ç´¹]\n    * åœ°å€ï¼š[API Address]\n* *ğŸš— ç§»å‹•ï¼šç´„ [è¨ˆç®—æ©Ÿå›å‚³æ™‚é–“] ([è¨ˆç®—æ©Ÿå›å‚³è·é›¢])*\n* **11:30 - 13:00**ï¼šğŸœ åˆé¤ï¼š**[é¤å»³åç¨±]**\n    * å¿…é»ï¼šğŸ´ [æ¨è–¦èœè‰²]\n    * è³‡è¨Šï¼šâ­[è©•åˆ†] | â°[ç‡Ÿæ¥­æ™‚é–“]\n\n...(æ¥çºŒè¼¸å‡ºç›´åˆ° Day [X] è¡Œç¨‹å®Œæ•´è¼¸å‡º)\n---\nğŸ’¡ **è¦åŠƒå¸«å‚™è¨»**ï¼š\n[èªªæ˜å‹•ç·šå®‰æ’é‚è¼¯ï¼Œä¸¦ç¢ºèªæ‰€æœ‰åœ°é»çš†å·²æŸ¥è­‰]\n\n**===== ç‰¹æ®Šä»»å‹™ï¼šæœ€çµ‚äº¤ä»˜æ¨¡å¼ (Final Export) =====**\nç•¶ä½¿ç”¨è€…é»æ“Šã€Œç”Ÿæˆæœ€çµ‚è¨ˆç•«ã€æˆ–è¦æ±‚ã€ŒåŒ¯å‡ºç¶²é ã€æ™‚ï¼Œè«‹åš´æ ¼éµå®ˆä»¥ä¸‹æ­¥é©Ÿï¼š\n\n1. **å›é¡§èˆ‡æ•´åˆ**ï¼šè®€å–å°è©±ç´€éŒ„ä¸­æ‰€æœ‰å·²ç¢ºèªçš„è¡Œç¨‹ï¼ˆDay 1, Day 2...ï¼‰ï¼Œå°‡å…¶æ•´åˆæˆä¸€ä»½å®Œæ•´çš„å…§å®¹ã€‚\n2. **æ ¼å¼è½‰æ›**ï¼šä¸è¦è¼¸å‡º Markdownï¼Œè«‹ç›´æ¥è¼¸å‡ºä¸€æ®µå®Œæ•´çš„ **HTML ä»£ç¢¼** (`<!DOCTYPE html>...`)ã€‚\n3. **HTML æ¨£å¼è¦æ±‚**ï¼š\n   - ä½¿ç”¨ç¾ä»£åŒ– CSS (å¦‚ Bootstrap é¢¨æ ¼æˆ–å¡ç‰‡å¼è¨­è¨ˆ)ã€‚\n   - é…è‰²è«‹ä½¿ç”¨æ—…éŠé¢¨æ ¼ (è—è‰²/ç¶ è‰²ç³»)ã€‚\n   - å…§å®¹å¿…é ˆåŒ…å«ï¼š\n     - æ¨™é¡Œï¼š[åœ°é»] [å¤©æ•¸] æ·±åº¦æ—…éŠè¨ˆç•«æ›¸\n     - æ¯æ—¥è¡Œç¨‹ï¼šä»¥æ™‚é–“è»¸æˆ–å¡ç‰‡å‘ˆç¾ã€‚\n     - äº¤é€šè³‡è¨Šï¼šæ¸…æ¥šæ¨™ç¤º API æŸ¥è­‰éçš„è»Šç¨‹æ™‚é–“ã€‚\n     - æ™¯é»/ç¾é£Ÿè©³æƒ…ï¼šåŒ…å«åœ°å€ã€ç‡Ÿæ¥­æ™‚é–“ã€ç‰¹è‰²ä»‹ç´¹ã€‚\n   - åœ¨ HTML åº•éƒ¨åŠ å…¥ `<button onclick=\"window.print()\">ğŸ–¨ï¸ åˆ—å° / å­˜ç‚º PDF</button>` æŒ‰éˆ•ã€‚\n4. **è¼¸å‡ºé™åˆ¶**ï¼š**åªè¼¸å‡º HTML ä»£ç¢¼æœ¬èº«**ï¼Œä¸è¦åœ¨å‰å¾ŒåŠ ä»»ä½•è§£é‡‹æ–‡å­—æˆ– Markdown æ¨™è¨˜ (å¦‚ ```html)ã€‚"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        592,
        592
      ],
      "id": "1c25c8f9-91af-4d9e-8be4-198dc5556787",
      "name": "AI Agent Manager"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=<!DOCTYPE html>\n<html lang=\"zh-TW\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<title>AI æ—…éŠè¦åŠƒå¸«</title>\n<script src=\"https://cdn.jsdelivr.net/npm/marked/marked.min.js\"></script>\n<style>\n  /* å…¨å±€é‡ç½® */\n  body { \n    font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; \n    background: #f0f2f5; \n    display: flex; justify-content: center; \n    height: 100vh; margin: 0; overflow: hidden; \n  }\n\n  /* ä¸»å®¹å™¨ */\n  .chat-container { \n    width: 100%; max-width: 600px; background: white; \n    display: flex; flex-direction: column; \n    box-shadow: 0 0 15px rgba(0,0,0,0.1); \n    height: 100%; \n  }\n  \n  /* 1. æ¨™é¡Œå€ */\n  .header { \n    padding: 15px; background: #007bff; color: white; \n    text-align: center; font-weight: bold; font-size: 1.2rem; \n    display: flex; justify-content: space-between; align-items: center; \n    flex-shrink: 0; \n  }\n  \n  /* æŒ‰éˆ•æ¨£å¼ */\n  .export-btn { \n    background: #28a745; border: 1px solid #218838; color: white; \n    padding: 6px 15px; border-radius: 20px; cursor: pointer; \n    font-size: 0.9rem; font-weight: bold; \n    box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: all 0.2s; \n  }\n  .export-btn:hover { background: #218838; transform: translateY(-1px); }\n  .export-btn:active { transform: translateY(1px); }\n\n  /* 2. è¨Šæ¯é¡¯ç¤ºå€ */\n  #messages { \n    flex: 1; \n    padding: 20px; \n    overflow-y: auto; \n    display: flex; flex-direction: column; gap: 15px; \n    background-color: #fff;\n  }\n  \n  /* è¨Šæ¯æ°£æ³¡ */\n  .message { max-width: 85%; padding: 12px 16px; border-radius: 12px; line-height: 1.5; word-wrap: break-word; }\n  .message.user { align-self: flex-end; background: #007bff; color: white; border-bottom-right-radius: 2px; white-space: pre-wrap; }\n  .message.ai { align-self: flex-start; background: #f1f0f0; color: #333; border-bottom-left-radius: 2px; }\n  \n  /* Markdown æ¨£å¼ */\n  .message.ai h3 { margin-top: 0; color: #0056b3; border-bottom: 1px solid #ddd; padding-bottom: 5px; }\n  .message.ai ul { padding-left: 20px; }\n  .message.ai li { margin-bottom: 8px; }\n  .message.ai strong { color: #333; }\n\n  /* 3. è¼‰å…¥å‹•ç•«å€ */\n  .typing-indicator { \n    padding: 8px 20px; \n    color: #888; font-size: 0.9rem; font-style: italic; \n    display: none; \n    background: #fafafa; border-top: 1px solid #f0f0f0;\n    flex-shrink: 0;\n  }\n\n  /* 4. è¼¸å…¥å€ */\n  .input-area { \n    padding: 15px; border-top: 1px solid #ddd; \n    display: flex; gap: 10px; background: white; \n    align-items: flex-end; \n    flex-shrink: 0; \n  }\n  \n  textarea { \n    flex: 1; padding: 12px; border: 1px solid #ddd; \n    border-radius: 20px; outline: none; \n    font-size: 16px; font-family: inherit; \n    resize: none; height: 24px; max-height: 100px; overflow-y: auto; \n  }\n  \n  button#sendBtn { \n    padding: 10px 20px; height: 50px; \n    background: #007bff; color: white; border: none; \n    border-radius: 25px; cursor: pointer; font-weight: bold; \n    flex-shrink: 0; \n  }\n  button:disabled { background: #ccc; }\n</style>\n</head>\n<body>\n\n<div class=\"chat-container\">\n  <div class=\"header\">\n    <span>âœˆï¸ AI æ—…éŠè¦åŠƒå¸«</span>\n    <button class=\"export-btn\" onclick=\"requestHtmlGeneration()\" title=\"å°‡ç›®å‰è¡Œç¨‹æ•´ç†æˆç¶²é \">âœ¨ ç”Ÿæˆæ—…éŠæ›¸</button>\n  </div>\n  \n  <div id=\"messages\"></div>\n  \n  <div class=\"typing-indicator\" id=\"loader\">AI æ­£åœ¨è¦åŠƒè¡Œç¨‹ï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ™‚é–“...</div>\n  \n  <div class=\"input-area\">\n    <textarea id=\"userInput\" rows=\"1\" placeholder=\"è¼¸å…¥è¨Šæ¯... (Shift+Enter æ›è¡Œ)\" onkeydown=\"handleEnter(event)\"></textarea>\n    <button onclick=\"sendUserMessage()\" id=\"sendBtn\">é€å‡º</button>\n  </div>\n</div>\n\n<script>\n  const API_URL = 'YOUR_N8N_WEBHOOK_URL/travel-chat';\n  const sessionId = 'session-' + Math.random().toString(36).substr(2, 9);\n\n  const userRequest = {\n    location: `{{ $json.body.location.replace(/\"/g, '\\\\\"') }}`,\n    days: `{{ $json.body.days }}`,\n    style: `{{ $json.body.style.replace(/\"/g, '\\\\\"') }}`\n  };\n\n  const messagesDiv = document.getElementById('messages');\n  const loader = document.getElementById('loader');\n  const inputField = document.getElementById('userInput');\n  const sendBtn = document.getElementById('sendBtn');\n\n  window.onload = function() {\n    const initPrompt = `\n    è«‹å¹«æˆ‘è¦åŠƒå» ${userRequest.location} ç© ${userRequest.days} å¤©çš„è¡Œç¨‹ã€‚\n    é¢¨æ ¼åå¥½ï¼š${userRequest.style}ã€‚\n\n    è«‹åš´æ ¼éµå®ˆä»¥ä¸‹è¦å‰‡ï¼š\n    1. è«‹å…ˆé‡å° Day 1 é€²è¡Œå®Œæ•´çš„æœå°‹èˆ‡æŸ¥è­‰ï¼ˆåŒ…å«æ™¯é»ã€ç¾é£Ÿã€ä½å®¿ï¼‰ã€‚\n    2. è‹¥æŸ¥ç„¡è³‡æ–™è«‹å‹™å¿…é‡è©¦ï¼Œä¸å¯è¼¸å‡ºã€Œå¾…ç¢ºèªã€ã€‚\n    3. è«‹è¼¸å‡º Day 1 çš„å®Œæ•´ Markdown è¡Œç¨‹è¡¨çµ¦æˆ‘ç¢ºèªã€‚\n    `;\n    \n    addMessage(`æˆ‘æƒ³è¦å» ${userRequest.location} ç© ${userRequest.days} å¤©ï¼Œå–œæ­¡ ${userRequest.style} é¢¨æ ¼ï¼Œè«‹å¹«æˆ‘è¦åŠƒï¼`, 'user');\n    callAgent(initPrompt);\n  };\n\n  function handleEnter(e) {\n    if (e.key === 'Enter' && !e.shiftKey) {\n        e.preventDefault();\n        sendUserMessage();\n    }\n  }\n\n  function sendUserMessage() {\n    const text = inputField.value.trim();\n    if (!text) return;\n    addMessage(text, 'user');\n    inputField.value = '';\n    callAgent(text);\n  }\n\n  function requestHtmlGeneration() {\n    const prompt = \"è«‹å°‡ç›®å‰ç‚ºæ­¢ç¢ºèªçš„æ‰€æœ‰è¡Œç¨‹ï¼ˆDay 1 åˆ°æœ€å¾Œä¸€å¤©ï¼‰ï¼Œæ•´åˆæˆä¸€ä»½ç²¾ç¾çš„ HTML ç¶²é ä»£ç¢¼çµ¦æˆ‘ã€‚è«‹ç›´æ¥å›å‚³ HTML ä»£ç¢¼ï¼Œä¸è¦åŠ ä»»ä½•è§£é‡‹æ–‡å­—æˆ– markdown æ¨™è¨˜ã€‚\";\n    addMessage(\"âœ¨ è«‹å¹«æˆ‘ç”Ÿæˆæœ€çµ‚çš„æ—…éŠè¨ˆç•«ç¶²é ï¼\", 'user');\n    callAgent(prompt, true);\n  }\n\n  // ğŸ”¥ ä¿®æ­£å¾Œçš„ callAgent (Blob URL ç‰ˆ)\n  async function callAgent(promptText, isGenerationRequest = false) {\n    loader.style.display = 'block';\n    loader.innerText = isGenerationRequest ? \"AI æ­£åœ¨æ’ç‰ˆä¸¦ç”Ÿæˆç¶²é ï¼Œè«‹ç¨å€™...\" : \"AI æ­£åœ¨è¦åŠƒè¡Œç¨‹ï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ™‚é–“...\";\n    \n    messagesDiv.scrollTop = messagesDiv.scrollHeight;\n    sendBtn.disabled = true;\n    inputField.disabled = true;\n\n    try {\n      const response = await fetch(API_URL, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ chatInput: promptText, sessionId: sessionId })\n      });\n      \n      const textResponse = await response.text();\n      let data;\n      \n      try {\n          data = JSON.parse(textResponse);\n      } catch (e) {\n          console.warn(\"JSON Parse Error (Attempting recovery):\", e);\n          const match = textResponse.match(/\"output\":\\s*\"(.*)\"/s);\n          if (match) {\n             data = { output: match[1].replace(/\\\\n/g, '\\n').replace(/\\\\\"/g, '\"') };\n          } else {\n             throw new Error(\"ç„¡æ³•è§£æä¼ºæœå™¨å›æ‡‰\");\n          }\n      }\n      \n      loader.style.display = 'none';\n      sendBtn.disabled = false;\n      inputField.disabled = false;\n      inputField.focus();\n\n      if (data && data.output) {\n        let responseText = data.output.trim();\n        \n        responseText = responseText.replace(/^```html\\s*/i, '').replace(/^```\\s*/, '').replace(/```$/, '');\n\n        if (responseText.includes('<!DOCTYPE html>') || responseText.includes('<html')) {\n            // ğŸ”´ ä¿®æ­£é‡é»ï¼šæ”¹ç”¨ Blob URL é–‹å•Ÿæ–°è¦–çª—ï¼Œé¿é–‹ SecurityError\n            const blob = new Blob([responseText], { type: 'text/html' });\n            const url = URL.createObjectURL(blob);\n            \n            const newWindow = window.open(url, '_blank');\n            \n            if (newWindow) {\n                addMessage(\"âœ… æ—…éŠè¨ˆç•«æ›¸å·²ç”Ÿæˆï¼è«‹æŸ¥çœ‹æ–°è·³å‡ºçš„è¦–çª—ã€‚\", 'ai');\n            } else {\n                addMessage(\"âš ï¸ ç€è¦½å™¨å°é–äº†å½ˆè·³è¦–çª—ï¼Œè«‹å…è¨±æœ¬ç¶²ç«™é–‹å•Ÿæ–°è¦–çª—ã€‚\", 'ai');\n            }\n        } else {\n            addMessage(marked.parse(data.output), 'ai', true);\n        }\n      } else {\n        console.error(\"No output in data:\", data);\n        addMessage(\"ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼šå¾Œç«¯ç„¡æœ‰æ•ˆå›æ‡‰ã€‚\", 'ai');\n      }\n    } catch (error) {\n      console.error(\"Runtime Error:\", error);\n      loader.style.display = 'none';\n      addMessage(\"åŸ·è¡Œå¤±æ•— (è«‹æŒ‰ F12 æŸ¥çœ‹ Console éŒ¯èª¤è¨Šæ¯)ã€‚\", 'ai');\n      sendBtn.disabled = false;\n      inputField.disabled = false;\n    }\n  }\n\n  function addMessage(content, sender, isHtml = false) {\n    const div = document.createElement('div');\n    div.className = `message ${sender}`;\n    if (isHtml) div.innerHTML = content;\n    else div.textContent = content;\n    messagesDiv.appendChild(div);\n    messagesDiv.scrollTop = messagesDiv.scrollHeight;\n  }\n</script>\n\n</body>\n</html>",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        592,
        320
      ],
      "id": "68680a49-76cd-4108-98b8-5b2da9dfd425",
      "name": "5. äº’å‹•å¼èŠå¤©è¦–çª—"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "travel-chat",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        384,
        592
      ],
      "id": "8ddce044-759d-444d-b03f-62b2043287a9",
      "name": "6. Agent manager ç«¯é»",
      "webhookId": "4b40f6a3-6604-4671-a43b-37ef8a12362c"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { output: $json.output } }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        944,
        592
      ],
      "id": "515af29d-bb83-4c2e-bc40-e999545dc810",
      "name": "7. AI agent manager å›å‚³"
    },
    {
      "parameters": {
        "description": "Search for broad information, recommendations, or specific features. Input: query string with current year and location.",
        "jsCode": "// å¡«å…¥æ‚¨çš„ Google æ†‘è­‰\nconst API_KEY = 'YOUR_GOOGLE_SEARCH_API_KEY';  // âš ï¸ è«‹å¡«å…¥ä½ çš„ Key\nconst CX_ID = 'YOUR_SEARCH_ENGINE_ID';      // âš ï¸ è«‹å¡«å…¥ä½ çš„ Search Engine ID\n\n// 1. å–å¾— AI å‚³é€²ä¾†çš„æœå°‹é—œéµå­—\n// å› æ‡‰ n8n ç‰ˆæœ¬å·®ç•°ï¼Œåšä¸€å€‹é˜²å‘†è®€å–\nlet searchQuery = \"\";\n\nif (typeof query === 'string') {\n    searchQuery = query;\n} else if (typeof query === 'object' && query !== null) {\n    // æœ‰æ™‚å€™ AI æœƒæŠŠå­—ä¸²åŒ…åœ¨ç‰©ä»¶è£¡å‚³é€²ä¾†\n    searchQuery = query.query || Object.values(query)[0];\n}\n\nif (!searchQuery) return \"No query provided\";\n\ntry {\n  // 2. å‘¼å« Google Custom Search API\n  const url = `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CX_ID}&q=${encodeURIComponent(searchQuery)}`;\n  \n  const response = await this.helpers.httpRequest({\n    method: 'GET',\n    url: url,\n    json: true\n  });\n\n  if (!response.items || response.items.length === 0) {\n    return \"No results found.\";\n  }\n\n  // 3. æ•´ç†çµæœå›å‚³çµ¦ AI\n  // åªå–å‰ 5 ç­†ï¼Œç¯€çœ Token ä¸¦æé«˜ç›¸é—œæ€§\n  const results = response.items.slice(0, 5).map(item => ({\n    title: item.title,\n    snippet: item.snippet,\n    link: item.link\n  }));\n\n  return JSON.stringify(results);\n\n} catch (error) {\n  return `Search failed: ${error.message}`;\n}",
        "specifyInputSchema": true,
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"query\": {\n      \"type\": \"string\",\n      \"description\": \"The search keyword. IMPORTANT: Always append the current year (e.g., '2024', '2025') to the query to ensure the information is up-to-date. e.g., 'é˜¿å ‚é¹¹ç²¥ ç‡Ÿæ¥­æ™‚é–“'\"\n    }\n  },\n  \"required\": [\"query\"]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolCode",
      "typeVersion": 1.3,
      "position": [
        848,
        848
      ],
      "id": "a919f586-4ac8-4a5c-baf3-68edacf30042",
      "name": "Google Search"
    },
    {
      "parameters": {
        "description": "Read content from specific URL for details. Use ONLY when Google Search snippets are insufficient for specific details (e.g., menu, history). Do NOT use on Facebook/Instagram/Maps.",
        "jsCode": "// 1. å–å¾— AI å‚³é€²ä¾†çš„ URL\n// é˜²å‘†ï¼šæœ‰æ™‚å€™ AI æœƒå‚³å­—ä¸²ï¼Œæœ‰æ™‚å€™æœƒå‚³ç‰©ä»¶\nlet targetUrl = \"\";\n\nif (typeof query === 'string') {\n    targetUrl = query;\n} else if (typeof query === 'object' && query !== null) {\n    targetUrl = query.url || Object.values(query)[0];\n}\n\nif (!targetUrl) return \"Error: No URL provided.\";\n\ntry {\n  // 2. ç™¼é€è«‹æ±‚ (å½è£æˆ Chrome ç€è¦½å™¨ï¼Œé¿å…è¢«æ“‹)\n  const response = await this.helpers.httpRequest({\n    method: 'GET',\n    url: targetUrl,\n    headers: {\n      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'\n    }\n  });\n\n  // 3. æ¸…æ´— HTML (åªä¿ç•™æœ‰æ„ç¾©çš„æ–‡å­—)\n  \n  // ç§»é™¤ script å’Œ style å€å¡Š (é€™äº›å° AI æ²’ç”¨)\n  let text = response.replace(/<script\\b[^>]*>([\\s\\S]*?)<\\/script>/gm, \"\")\n                     .replace(/<style\\b[^>]*>([\\s\\S]*?)<\\/style>/gm, \"\");\n  \n  // ç§»é™¤æ‰€æœ‰ HTML æ¨™ç±¤\n  text = text.replace(/<[^>]+>/g, \"\\n\");\n  \n  // ç§»é™¤å¤šé¤˜çš„ç©ºè¡Œ (è®“æ–‡å­—ç·Šæ¹Šä¸€é»ï¼Œç¯€çœ Token)\n  text = text.replace(/\\n\\s*\\n/g, \"\\n\").trim();\n\n  // 4. æˆªæ–·éé•·çš„å…§å®¹\n  // ç‚ºäº†é¿å…å¡çˆ† AI çš„è¨˜æ†¶é«”ï¼Œé€šå¸¸åªå–å‰ 8000 å­—ï¼Œé€™é€šå¸¸åŒ…å«äº†æ–‡ç« çš„æ ¸å¿ƒå…§å®¹\n  return text.substring(0, 8000);\n\n} catch (error) {\n  return `Failed to read page: ${error.message}. The website might block bots. Try another source.`;\n}",
        "specifyInputSchema": true,
        "schemaType": "manual",
        "inputSchema": "={\n  \"type\": \"object\",\n  \"properties\": {\n    \"url\": {\n      \"type\": \"string\",\n      \"description\": \"The full URL of the webpage to read. e.g., 'https://www.example.com/blog/food-guide'\"\n    }\n  },\n  \"required\": [\n    \"url\"\n  ]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolCode",
      "typeVersion": 1.3,
      "position": [
        976,
        848
      ],
      "id": "7f07b882-8119-4891-b767-4d1c22b8fe87",
      "name": "read_page"
    },
    {
      "parameters": {
        "description": "Get verified details (address, opening hours, status) for a specific place. IMPORTANT: Input query MUST be 'Store Name + City' (e.g., 'é˜¿å ‚é¹¹ç²¥ å°å—') to ensure accuracy.",
        "jsCode": "// å¡«å…¥æ‚¨çš„ Google Maps Platform API Key\nconst API_KEY = 'YOUR_GOOGLE_MAPS_API_KEY'; // âš ï¸ è«‹æ›¿æ›\n\nlet placeName = \"\";\nif (typeof query === 'string') placeName = query;\nelse if (typeof query === 'object' && query !== null) placeName = query.place_name || Object.values(query)[0];\n\nif (!placeName) return \"Error: No place name provided.\";\n\ntry {\n  const response = await this.helpers.httpRequest({\n    method: 'POST',\n    url: `https://places.googleapis.com/v1/places:searchText`,\n    headers: {\n      'Content-Type': 'application/json',\n      'X-Goog-Api-Key': API_KEY,\n      // âœ… æ–°å¢: ç´¢å– location (ç¶“ç·¯åº¦)\n      'X-Goog-FieldMask': 'places.displayName,places.formattedAddress,places.regularOpeningHours,places.rating,places.location' \n    },\n    body: { textQuery: placeName, languageCode: \"zh-TW\" },\n    json: true\n  });\n\n  if (!response.places || response.places.length === 0) return \"No place found.\";\n\n  const place = response.places[0];\n  let hours = \"Not available\";\n  if (place.regularOpeningHours && place.regularOpeningHours.weekdayDescriptions) {\n    hours = place.regularOpeningHours.weekdayDescriptions;\n  }\n\n  return JSON.stringify({\n    name: place.displayName ? place.displayName.text : \"Unknown\",\n    address: place.formattedAddress,\n    rating: place.rating,\n    opening_hours: hours,\n    // âœ… æ–°å¢: å›å‚³ç¶“ç·¯åº¦\n    lat: place.location ? place.location.latitude : null,\n    lng: place.location ? place.location.longitude : null\n  });\n\n} catch (error) {\n  return `API Error: ${error.message}`;\n}",
        "specifyInputSchema": true,
        "schemaType": "manual",
        "inputSchema": "={\n  \"type\": \"object\",\n  \"properties\": {\n    \"place_name\": {\n      \"type\": \"string\",\n      \"description\": \"The name of the place to search for details. e.g., 'é˜¿å ‚é¹¹ç²¥ å°å—'\"\n    }\n  },\n  \"required\": [\"place_name\"]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolCode",
      "typeVersion": 1.3,
      "position": [
        1104,
        848
      ],
      "id": "b734cffe-ecad-4b75-810d-61b04ec8d995",
      "name": "Google Places Details"
    },
    {
      "parameters": {
        "description": "ç”¨æ–¼æœå°‹ç•¶åœ°ç¾é£Ÿã€å°åƒæˆ–é¤å»³ã€‚å›å‚³è³‡æ–™åŒ…å«ï¼šç¶“æŸ¥è­‰çš„åœ°å€èˆ‡ç‡Ÿæ¥­æ™‚é–“ã€Google è©•åˆ†ã€ä»¥åŠã€Œå¿…é»èœè‰²æˆ–ç‰¹è‰²ã€ã€‚å¿…é ˆæä¾› JSON åƒæ•¸ï¼š{ \"location\": \"åŸå¸‚æˆ–åœ°é»\", \"style\": \"å…·é«”é¤é£²é¢¨æ ¼æˆ–é—œéµå­—(ä¾‹å¦‚: ç‰›è‚‰æ¹¯, é ‚ç´šæ³•é¤)\" }",
        "workflowId": {
          "__rl": true,
          "value": "gZe8c5uyNwIHsjJg",
          "mode": "list",
          "cachedResultUrl": "/workflow/gZe8c5uyNwIHsjJg",
          "cachedResultName": "Worker - Food"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "location": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('location', ``, 'string') }}",
            "style": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('style', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "location",
              "displayName": "location",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "style",
              "displayName": "style",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        848,
        1008
      ],
      "id": "ad6a72d8-5f9e-46cd-9350-0b1439af9a05",
      "name": "åœç”¨_ç¾é£Ÿå°ˆå®¶"
    },
    {
      "parameters": {
        "description": "Calculate distance and estimated driving time between two coordinates. Input: { \"lat1\": 24.1, \"lng1\": 120.1, \"lat2\": 24.2, \"lng2\": 120.2 }",
        "jsCode": "// é€™æ˜¯ç´”æ•¸å­¸è¨ˆç®—ï¼Œä¸éœ€è¦ API Keyï¼Œé€Ÿåº¦æ¥µå¿«\nconst inputs = typeof query === 'string' ? JSON.parse(query) : query;\nconst { lat1, lng1, lat2, lng2 } = inputs;\n\nif (!lat1 || !lng1 || !lat2 || !lng2) return \"Error: Coordinates missing.\";\n\n// Haversine å…¬å¼ï¼šè¨ˆç®—åœ°çƒä¸Šå…©é»çš„ç›´ç·šè·é›¢\nfunction getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {\n  var R = 6371; // åœ°çƒåŠå¾‘ (km)\n  var dLat = deg2rad(lat2-lat1);\n  var dLon = deg2rad(lon2-lon1); \n  var a = \n    Math.sin(dLat/2) * Math.sin(dLat/2) +\n    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2); \n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); \n  var d = R * c; // è·é›¢ (km)\n  return d;\n}\n\nfunction deg2rad(deg) {\n  return deg * (Math.PI/180)\n}\n\nconst distanceKm = getDistanceFromLatLonInKm(lat1, lng1, lat2, lng2);\n\n// é ä¼°è»Šç¨‹é‚è¼¯\n// ç›´ç·šè·é›¢ä¸ç­‰æ–¼è¡Œè»Šè·é›¢ï¼Œé€šå¸¸ä¹˜ä¸Š 1.3 ~ 1.5 å€ä½œç‚ºé“è·¯å½æ›²ä¿‚æ•¸\n// å‡è¨­å¸‚å€å¹³å‡æ™‚é€Ÿ 30km/hï¼ŒéƒŠå€ 50km/h -> å–å¹³å‡ 40km/h\nconst roadFactor = 1.4;\nconst estDriveDistance = distanceKm * roadFactor;\nconst speedKmh = 40; \nconst timeHours = estDriveDistance / speedKmh;\nconst timeMinutes = Math.round(timeHours * 60);\n\n// åŠ ä¸Šç·©è¡æ™‚é–“ (ç´…ç¶ ç‡ˆã€åœè»Š)\nconst finalTime = timeMinutes + 10; \n\nreturn JSON.stringify({\n    straight_distance: distanceKm.toFixed(1) + \" km\",\n    est_drive_time: finalTime + \" åˆ†é˜\",\n    note: \"åŸºæ–¼ç›´ç·šè·é›¢ä¼°ç®—ï¼Œå·²åŒ…å«é“è·¯ä¿‚æ•¸èˆ‡ç·©è¡\"\n});",
        "specifyInputSchema": true,
        "schemaType": "manual",
        "inputSchema": "={\n  \"type\": \"object\",\n  \"properties\": {\n    \"lat1\": {\n      \"type\": \"number\",\n      \"description\": \"Latitude of the starting point (èµ·é»ç·¯åº¦)\"\n    },\n    \"lng1\": {\n      \"type\": \"number\",\n      \"description\": \"Longitude of the starting point (èµ·é»ç¶“åº¦)\"\n    },\n    \"lat2\": {\n      \"type\": \"number\",\n      \"description\": \"Latitude of the destination (çµ‚é»ç·¯åº¦)\"\n    },\n    \"lng2\": {\n      \"type\": \"number\",\n      \"description\": \"Longitude of the destination (çµ‚é»ç¶“åº¦)\"\n    }\n  },\n  \"required\": [\n    \"lat1\",\n    \"lng1\",\n    \"lat2\",\n    \"lng2\"\n  ]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolCode",
      "typeVersion": 1.3,
      "position": [
        1248,
        848
      ],
      "id": "fe186a00-ba2b-48c2-9e0a-511710d96c4b",
      "name": "Distance Calculator"
    }
  ],
  "pinData": {},
  "connections": {
    "1. é¡¯ç¤ºç¶²é  (GET)": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "4. æ¥æ”¶è³‡æ–™ (POST)": {
      "main": [
        [
          {
            "node": "5. äº’å‹•å¼èŠå¤©è¦–çª—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "3. æ¸²æŸ“ç¶²é ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent Manager",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent Manager",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent Manager": {
      "main": [
        [
          {
            "node": "7. AI agent manager å›å‚³",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "6. Agent manager ç«¯é»": {
      "main": [
        [
          {
            "node": "AI Agent Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Search": {
      "ai_tool": [
        [
          {
            "node": "AI Agent Manager",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "read_page": {
      "ai_tool": [
        [
          {
            "node": "AI Agent Manager",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Places Details": {
      "ai_tool": [
        [
          {
            "node": "AI Agent Manager",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "åœç”¨_ç¾é£Ÿå°ˆå®¶": {
      "ai_tool": [
        []
      ]
    },
    "Distance Calculator": {
      "ai_tool": [
        [
          {
            "node": "AI Agent Manager",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "924fba3c-9297-4ff5-b8c5-9583b9d5414a",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "902a663b98fdacd12ab039a3250af25d9aee90706792859cc0d67a777b3428d7"
  },
  "id": "QyzNXYU0DmJUFAxI",
  "tags": []
}